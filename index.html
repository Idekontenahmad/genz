// server.js
// Backend sederhana untuk analisis gambar pakai Vision AI (contoh arsitektur).
// Jalankan: npm init -y && npm install express multer node-fetch && node server.js

const express = require("express");
const multer = require("multer");
const fetch = require("node-fetch"); // untuk call API ke Vision AI
const path = require("path");

const app = express();
const upload = multer({ storage: multer.memoryStorage() });

const PORT = process.env.PORT || 3000;

// Serve file static (index.html, css, js)
app.use(express.static(path.join(__dirname)));

// Endpoint analisis gambar
app.post("/api/analyze-image", upload.single("image"), async (req, res) => {
  try {
    if (!req.file) {
      return res.status(400).json({ error: "Tidak ada file gambar yang diterima." });
    }

    const imageBuffer = req.file.buffer;
    const base64Image = imageBuffer.toString("base64");

    // ============================
    // DI SINI BAGIAN INTI AI
    // ============================

    // Contoh ide: pakai Vision AI (misal Google Gemini Vision)
    // Kamu perlu:
    // - API key
    // - Endpoint Vision
    // - Prompt bahwa kamu ingin deskripsi: tema, format, objek utama, aksi, warna dominan

    // PSEUDOCODE:
    // const apiKey = process.env.GEMINI_API_KEY;
    // const response = await fetch("https://...vision-endpoint...", {
    //   method: "POST",
    //   headers: {
    //     "Content-Type": "application/json",
    //     "Authorization": `Bearer ${apiKey}`
    //   },
    //   body: JSON.stringify({
    //     image: base64Image,
    //     instructions: "Analisis gambar produk ini dan kembalikan JSON berisi: tema, format, objekUtama, aksi, warnaDominan untuk konten marketing vertical video."
    //   })
    // });
    //
    // const aiResult = await response.json();
    // const { tema, format, objekUtama, aksi, warnaDominan } = aiResult;

    // ============================
    // SEMENTARA: MOCK / CONTOH
    // (Biar langsung bisa dicoba meskipun belum sambung ke API beneran)
    // ============================
    const tema = "review produk skincare minimalis";
    const format = "minimalis profesional";
    const objekUtama = "tangan wanita memegang botol skincare, label produk terlihat jelas sebagai fokus utama gambar";
    const aksi = "produk diangkat pelan ke arah kamera seolah sedang direview, dengan gesture lembut dan natural";
    const warnaDominan = "putih, beige, dan sedikit hijau pastel";

    // KIRIM BALIK KE FRONTEND
    res.json({
      tema,
      format,
      objekUtama,
      aksi,
      warnaDominan,
    });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: "Gagal menganalisis gambar dengan AI." });
  }
});

app.listen(PORT, () => {
  console.log(`Server berjalan di http://localhost:${PORT}`);
});
